points:
  rotate: 0
  zones:
    matrix:
      columns:
        pinky:
          origin: [ 0, -1cy ]
          rotate: 19  # 19 degrees
          stagger: 0 # affects distance to previous column so useless for a left pinky column
          spread: 0 # affects distance to previous column so useless for a left pinky column
          key:
            column_net: P4
            column_mark: P
        ring:
          origin: [ 0, -1cy ]
          rotate: -4 # 15 degrees
          stagger: 10
          spread: 23
          key:
            column_net: P5
            column_mark: R
        middle:
          origin: [ 0, -1cy ]
          rotate: -10 # 5 degrees
          stagger: -1
          spread: 18
          key:
            column_net: P6
            column_mark: M
        index:
          origin: [ 0, -1cy ]
          rotate: -5 # 0 degrees
          stagger: -3
          spread: 20
          key:
            column_net: P21
            column_mark: IN
        inner:
          origin: [ 0, -1cy ]
          rotate: 0
          stagger: -1
          key:
            column_net: P20
            column_mark: I
      rows:
        bottom:
          padding: 1cy
          row_net: P16
        home:
          padding: 1cy
          row_net: P17
        top:
          padding: 1cy
          row_net: P18
    thumbfan:
      anchor:
        ref: matrix_inner_bottom
        shift: [ -3, -22 ]
      columns:
        near:
          rotate: -15
          key:
            column_net: P6
            column_mark: M
        home:
          spread: 19
          rotate: -10 # -25 degrees cumulative
          origin: [-9.5, -9]
          key:
            column_net: P5
            column_mark: R
        far:
          spread: 19
          rotate: -10 # 35 degrees cumulative
          origin: [-9.5, -9]
          key:
            column_net: P4
            column_mark: P
      rows:
        thumb:
          padding: 0
          row_net: P7
  key:
    footprints:
      choc_hotswap:
        type: choc
        nets:
          from: =colrow
          to: =column_net
        params:
          keycaps: true
          reverse: true
          hotswap: true
      choc:
        type: choc
        anchor:
          rotate: 180
        nets:
          from: =colrow
          to: =column_net
        params:
          keycaps: true
          reverse: true
      diode:
        type: diode
        anchor:
          rotate: 90
          shift: [ 8.25, 0 ]
        nets:
          from: =colrow
          to: =row_net
        params:
          via_in_pad: true
          through_hole: false
outlines:
  exports:
    raw:
      - type: polygon
        points:
          - ref: matrix_pinky_bottom
            shift: [ -10 , -31.5 ]
          - ref: matrix_pinky_top
            shift: [ -10, 16 ]
          - ref: matrix_middle_top
            shift: [ -9, 14 ]
          - ref: matrix_inner_top
            shift: [ 30, 13 ]
          - ref: matrix_inner_top
            shift: [ 47.5, -0.5 ]
          - ref: thumbfan_far_thumb
            shift: [ 10, 9 ]
          - ref: thumbfan_far_thumb
            shift: [ 10, -9 ]
        operation: stack
    panel:
      - type: outline
        name: raw
        fillet: 0.5
    switch_cutouts:
      - type: keys
        side: left
        size: 14
        bound: false
    keycap_outlines:
      - type: keys
        side: left
        size: [17.9, 16.9]
        bound: false
    switch_plate:
      main:
        type: outline
        name: raw
        fillet: 0.5
      keyholes:
        type: outline
        name: switch_cutouts
        operation: subtract
    choc_caps_plate:
      main:
        type: outline
        name: raw
        fillet: 0.5
      keycaps:
        type: outline
        name: keycap_outlines
        operation: subtract
pcbs:
  tuck-n-roll:
    outlines:
      main:
        outline: panel
    footprints:
      promicro:
        type: promicro
        anchor:
          ref: matrix_inner_top
          shift: [28, -8]
          rotate: -127
        params:
          orientation: down
      scrollwheel:
        type: scrollwheel
        anchor:
          ref: matrix_index_bottom
          shift: [ -3, -20 ]
          rotate: -90
        nets:
          from: P21
          to: GND
          A: P8
          B: P9
          C: P14
          D: P15
        params:
          reverse: true
cases:
  switchplate:
    - type: outline
      name: switch_plate
      extrude: 1.2 # mm, choc
      shift: [ 0, 0, 0 ]
      rotate: [ 0, 0, 0 ]
      operation: add